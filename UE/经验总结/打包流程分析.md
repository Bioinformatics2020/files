## 从打包按钮到AutomationTool

1. 打包按钮背后的代码事件：FMainFrameActionCallbacks::PackageProject
2. 准备命令行参数并触发UAT任务：FUATHelperModule::CreateUatTask
3. 创建进程执行UAT："D:/UE_4.27/UE4_Private-HMI-4.27_20240512/Engine/Build/BatchFiles/RunUAT.bat" -ScriptsForProject="D:/UE_4.27/QNXProject/UpdateDll/UpdateDll.uproject" BuildCookRun -nocompileeditor -nop4 -project="D:/UE_4.27/QNXProject/UpdateDll/UpdateDll.uproject" -cook -stage -archive -archivedirectory="D:/UE_4.27/QNXProject/UpdateDll" -package -ue4exe="D:\UE_4.27\UE4_Private-HMI-4.27_20240512\Engine\Binaries\Win64\UE4Editor-Cmd.exe"  -compressed -ddc=DerivedDataBackendGraph -pak -prereqs -nodebuginfo -targetplatform=Linux -build -target=UpdateDll -clientconfig=Development -utf8output
4. RunUAT.bat执行AutomationToolLauncher.exe，向最后方添加**-compile**参数
5. AutomationToolLauncher.exe执行AutomationTool.exe，转发参数

## AutomationTool

UBT 调用堆栈

Program.cs Main()

Automation.cs Process()

Automation.cs Execute()

执行BuildCookRun::DoBuildCookRun完成构建、烘焙、运行

BuildProjectCommand.Automation.cs Build() 开始构建



```c#
Project.Build(this, Params, WorkingCL, bGenerateNativeScripts ? (ProjectBuildTargets.All & ~ClientTargets) : 	ProjectBuildTargets.All);
Project.Cook(Params);
      if (bGenerateNativeScripts)
      {
          // crash reporter is built along with client targets, so we need to 
          // include that target flag here as well - note: that its not folded
          // into ClientTargets because the editor needs its own CrashReporter 
          // as well (which would be built above)
          Project.Build(this, Params, WorkingCL, ClientTargets | ProjectBuildTargets.CrashReporter);
      }
      
Project.CopyBuildToStagingDirectory(Params);
Project.Package(Params, WorkingCL);
Project.Archive(Params);
Project.Deploy(Params);
PrintRunTime();
Project.Run(Params);
Project.GetFile(Params);
```

## 项目构建：BuildProjectCommand.Automation.cs Build()

转发到UBT，参考如下命令

UpdateDll QNX Development -Project=D:\UE_4.27\QNXProject\UpdateDll\UpdateDll.uproject  D:\UE_4.27\QNXProject\UpdateDll\UpdateDll.uproject -NoUBTMakefiles  -remoteini="D:\UE_4.27\QNXProject\UpdateDll" -skipdeploy -Manifest=D:\UE_4.27\UE4_Private-HMI-4.27_20240512\Engine\Intermediate\Build\Manifest.xml -NoHotReload -log="D:\UE_4.27\UE4_Private-HMI-4.27_20240512\Engine\Programs\AutomationTool\Saved\Logs\UBT-UpdateDll-QNX-Development.txt"



UpdateDll Linux Development -Project=D:\UE_4.27\QNXProject\UpdateDll\UpdateDll.uproject  D:\UE_4.27\QNXProject\UpdateDll\UpdateDll.uproject -NoUBTMakefiles  -remoteini="D:\UE_4.27\QNXProject\UpdateDll" -skipdeploy -Manifest=D:\UE_4.27\UE4_Private-HMI-4.27_20240512\Engine\Intermediate\Build\Manifest.xml -NoHotReload -log="D:\UE_4.27\UE4_Private-HMI-4.27_20240512\Engine\Programs\AutomationTool\Saved\Logs\UBT-UpdateDll-Linux-Development.txt"

## UnrealBuildTool.cs Main()

BuildMode.cs Execute()

RulersAssembly.cs CreateModuleRules 获取build.cs文件信息

LinuxToolChain,.cs CompileCPPFiles 生成编译命令

BuildMode.cs ActionGraph.CheckForConflicts() 确保没有操作与任何其他操作冲突

BuildMode.cs ActionGraph.ExecuteActions()

ParallelExecutor.cs ExecuteActions()

ParallelExecutor.cs ExecuteAction()在这里创建进程执行编译任务



创建大量进程执行D:\QNX\qnx710\host\win64\x86_64\usr\bin\ntoaarch64-c++.exe   @"D:\UE_4.27\UE4_Private-HMI-4.27_20240512\Engine\Intermediate\Build\QNX\4FCC\UE4\Development\CinematicCamera\Module.CinematicCamera.cpp.o.rsp"



最新报错：

"D:/QNX/qnx710/host/win64/x86_64/usr/bin/ntoaarch64-ar.exe"  rcs "D:/UE_4.27/UE4_Private-HMI-4.27_20240512/Engine/Binaries/QNX/UE4-UMG.so" @"D:/UE_4.27/UE4_Private-HMI-4.27_20240512/Engine/Intermediate/Build/QNX/4FCC/UE4/Development/UMG/UE4-UMG.so.response" && "D:/QNX/qnx710/host/win64/x86_64/usr/bin/ntoaarch64-ranlib.exe" "D:/UE_4.27/UE4_Private-HMI-4.27_20240512/Engine/Binaries/QNX/UE4-UMG.so"





最新进展：调查QNXToolChain.cs的 relink